# ChÆ°Æ¡ng 5: Unity Engine Case Study â€” Tá»« C++ Core Ä‘áº¿n C# Scripting

> **Má»¥c tiÃªu chÆ°Æ¡ng:** Hiá»ƒu kiáº¿n trÃºc ná»™i bá»™ cá»§a Unity Engine, táº¡i sao nÃ³ dÃ¹ng hai ngÃ´n ngá»¯ (C++ vÃ  C#), cÃ¡ch Mono/IL2CPP/Burst chuyá»ƒn code thÃ nh mÃ£ mÃ¡y, vÃ  cÃ¡ch DOTS táº­n dá»¥ng toÃ n bá»™ kiáº¿n thá»©c pháº§n cá»©ng tá»« Chapter 1-4.

---

## 1. Kiáº¿n trÃºc Unity â€” Táº¡i sao Dual-Language?

### 1.1. BÃ i toÃ¡n thiáº¿t káº¿ Engine

```
Engine game cáº§n giáº£i quyáº¿t HAI bÃ i toÃ¡n TRÃI NGÆ¯á»¢C nhau:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                 â”‚
  â”‚  BÃ€I TOÃN 1: HIá»†U NÄ‚NG Cá»°C CAO                                â”‚
  â”‚  â†’ Rendering pipeline: xá»­ lÃ½ hÃ ng triá»‡u tam giÃ¡c/frame         â”‚
  â”‚  â†’ Physics engine: va cháº¡m, ragdoll, fluid                      â”‚
  â”‚  â†’ Memory management: pool, allocator, alignment                â”‚
  â”‚  â†’ Audio mixer: sample processing at 48 KHz                    â”‚
  â”‚                                                                 â”‚
  â”‚  YÃŠU Cáº¦U: C/C++ (truy cáº­p trá»±c tiáº¿p hardware, zero overhead)   â”‚
  â”‚                                                                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                                 â”‚
  â”‚  BÃ€I TOÃN 2: ITERATION NHANH CHO GAME LOGIC                    â”‚
  â”‚  â†’ Viáº¿t AI, UI, gameplay rules, quests, dialogues              â”‚
  â”‚  â†’ Cáº§n hot-reload (sá»­a code â†’ tháº¥y káº¿t quáº£ ngay)              â”‚
  â”‚  â†’ Level designer / artist cÅ©ng cáº§n scripting Ä‘Æ¡n giáº£n          â”‚
  â”‚  â†’ Crash do pointer bug = máº¥t hÃ ng giá» debug                   â”‚
  â”‚                                                                 â”‚
  â”‚  YÃŠU Cáº¦U: NgÃ´n ngá»¯ an toÃ n, dá»… há»c, GC tá»± quáº£n lÃ½ bá»™ nhá»›      â”‚
  â”‚                                                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â†’ GIáº¢I PHÃP: Chia engine thÃ nh 2 táº§ng.
```

### 1.2. Kiáº¿n trÃºc hai táº§ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UNITY ENGINE ARCHITECTURE                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€ C# Scripting Layer (Frontend) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Game Logic:                                                 â”‚   â”‚
â”‚  â”‚   â— MonoBehaviour scripts (Update, Start, ...)               â”‚   â”‚
â”‚  â”‚   â— ScriptableObjects (data assets)                          â”‚   â”‚
â”‚  â”‚   â— ECS Systems (ISystem, SystemBase)                        â”‚   â”‚
â”‚  â”‚   â— UI Toolkit (UXML, USS)                                  â”‚   â”‚
â”‚  â”‚   â— Editor Extensions (Custom Inspectors, Tools)             â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Runtime: Mono JIT (Editor) / IL2CPP AOT (Build)             â”‚   â”‚
â”‚  â”‚  Hot-reload: Domain Reload khi sá»­a script                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                        â”‚
â”‚                   C# â†” C++ Binding Layer                            â”‚
â”‚                   (Internal Calls / P/Invoke)                       â”‚
â”‚                            â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  C++ Native Engine (Backend)                                 â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚  Rendering   â”‚  â”‚   Physics    â”‚  â”‚    Audio     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  (SRP Core,  â”‚  â”‚  (PhysX /    â”‚  â”‚  (FMOD /     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚   Graphics   â”‚  â”‚   Custom)    â”‚  â”‚   Native)    â”‚       â”‚   â”‚
â”‚  â”‚  â”‚   API abstraction) â”‚            â”‚  â”‚              â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚   Memory     â”‚  â”‚  Job System  â”‚  â”‚  Animation   â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  Management  â”‚  â”‚  (Native     â”‚  â”‚  (Mecanim    â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  (Allocators,â”‚  â”‚   threads)   â”‚  â”‚   native)    â”‚       â”‚   â”‚
â”‚  â”‚  â”‚   Pools)     â”‚  â”‚              â”‚  â”‚              â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚  â”‚  â”‚  Asset       â”‚  â”‚  Platform    â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  Pipeline    â”‚  â”‚  Abstraction â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚  (Import,    â”‚  â”‚  (Win, Mac,  â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚   Serialize) â”‚  â”‚   iOS, Andr) â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Compiled thÃ nh: UnityPlayer.dll (Win), libunity.so (Andr)  â”‚   â”‚
â”‚  â”‚  100% native code â€” compiler tá»‘i Æ°u cho tá»«ng platform        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€ Platform Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  OS APIs: Win32, Cocoa, JNI, ...                             â”‚   â”‚
â”‚  â”‚  Graphics APIs: Direct3D 12, Vulkan, Metal, WebGPU, OpenGL   â”‚   â”‚
â”‚  â”‚  Input: XInput, HID, Touch events                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3. C# â†” C++ Binding â€” Lá»›p keo dÃ­nh

```
Khi báº¡n gá»i transform.position trong C#, Ä‘iá»u gÃ¬ xáº£y ra?

  C# Code:
  â”€â”€â”€â”€â”€â”€â”€â”€
  transform.position = new Vector3(1, 2, 3);


  Thá»±c táº¿ bÃªn dÆ°á»›i:

  â”Œâ”€â”€ C# Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  // UnityEngine.Transform (C# wrapper class)             â”‚
  â”‚  public Vector3 position {                               â”‚
  â”‚      set {                                                â”‚
  â”‚          SetPosition_Injected(ref value);  // â† gá»i C++  â”‚
  â”‚      }                                                    â”‚
  â”‚  }                                                        â”‚
  â”‚                                                          â”‚
  â”‚  [MethodImpl(MethodImplOptions.InternalCall)]             â”‚
  â”‚  extern static void SetPosition_Injected(ref Vector3 v); â”‚
  â”‚  // â†‘ "InternalCall" = hÃ m nÃ y KHÃ”NG cÃ³ body C#          â”‚
  â”‚  //   NÃ³ Ä‘Æ°á»£c link trá»±c tiáº¿p tá»›i hÃ m C++ trong engine    â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Marshalling (chuyá»ƒn Ä‘á»•i data layout)
                         â”‚ Vector3 (C#) â†’ Vector3f (C++)
                         â–¼
  â”Œâ”€â”€ C++ Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  // Transform.cpp (trong Unity C++ engine)                â”‚
  â”‚  void Transform::SetPosition(const Vector3f& pos) {      â”‚
  â”‚      m_LocalPosition = TransformPoint(                    â”‚
  â”‚          GetParent(), pos);                                â”‚
  â”‚      // â†’ Cáº­p nháº­t TransformHierarchy                     â”‚
  â”‚      // â†’ Invalidate bounding boxes                       â”‚
  â”‚      // â†’ Notify Physics engine                           â”‚
  â”‚      // â†’ Mark dirty cho rendering                        â”‚
  â”‚      SetDirty();                                          â”‚
  â”‚  }                                                        â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Chi phÃ­ Managed â†” Native transition:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Má»—i láº§n gá»i C++ tá»« C#:                                   â”‚
  â”‚    1. Marshalling data types (~10-50ns)                    â”‚
  â”‚    2. Safety checks (null, thread) (~5-20ns)               â”‚
  â”‚    3. Actual C++ execution (varies)                        â”‚
  â”‚    4. Marshal return value back (~10-50ns)                  â”‚
  â”‚                                                            â”‚
  â”‚  Overhead: ~30-100ns PER CALL                              â”‚
  â”‚                                                            â”‚
  â”‚  â†’ 10,000 GetComponent<T>() calls / frame                 â”‚
  â”‚  â†’ 10,000 Ã— 100ns = 1ms OVERHEAD ALONE!                   â”‚
  â”‚  â†’ ÄÃ¢y lÃ  lÃ½ do cache references á»Ÿ Awake()                â”‚
  â”‚                                                            â”‚
  â”‚  DOTS bypass:                                              â”‚
  â”‚  â†’ IComponentData = pure C# structs, KHÃ”NG gá»i C++        â”‚
  â”‚  â†’ SystemAPI.Query = iterate trá»±c tiáº¿p trÃªn bá»™ nhá»› C#     â”‚
  â”‚  â†’ Burst compile = native code KHÃ”NG cáº§n marshalling       â”‚
  â”‚  â†’ Chi phÃ­: 0ns overhead!                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Mono vs IL2CPP â€” Chi tiáº¿t ká»¹ thuáº­t

### 2.1. Mono Runtime â€” JIT Compilation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONO RUNTIME                                     â”‚
â”‚                                                                     â”‚
â”‚  Khi Unity Editor cháº¡y Play Mode:                                   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€ Domain Reload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Unload táº¥t cáº£ scripts cÅ©                                  â”‚  â”‚
â”‚  â”‚ 2. Load .dll files má»›i (Assembly-CSharp.dll, ...)             â”‚  â”‚
â”‚  â”‚ 3. Táº¡o láº¡i static state                                      â”‚  â”‚
â”‚  â”‚ 4. Gá»i [RuntimeInitializeOnLoadMethod]                        â”‚  â”‚
â”‚  â”‚ â†’ Domain Reload máº¥t: 2-10 giÃ¢y (tÃ¹y project size)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€ JIT Compilation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Láº§n Ä‘áº§u gá»i Update() trÃªn EnemyAI script:                   â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  IL Bytecode (trong .dll):                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”‚
â”‚  â”‚  â”‚ .method void Update() {              â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚   ldarg.0                            â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚   ldfld float3 position              â”‚ â†’ JIT Compiler      â”‚  â”‚
â”‚  â”‚  â”‚   ldarg.0                            â”‚   phÃ¢n tÃ­ch IL      â”‚  â”‚
â”‚  â”‚  â”‚   ldfld float3 velocity              â”‚   vÃ  sinh ra        â”‚  â”‚
â”‚  â”‚  â”‚   ldsfld float deltaTime             â”‚   native code       â”‚  â”‚
â”‚  â”‚  â”‚   mul                                â”‚   táº¡i runtime       â”‚  â”‚
â”‚  â”‚  â”‚   add                                â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚   stfld float3 position              â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ }                                    â”‚                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â”‚                    â”‚                                           â”‚  â”‚
â”‚  â”‚                    â–¼                                           â”‚  â”‚
â”‚  â”‚  Native Code (trong memory):                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”‚
â”‚  â”‚  â”‚ ; x86-64 â€” Mono JIT output           â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ push    rbp                          â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ mov     rbp, rsp                     â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ movss   xmm0, [rcx+0x10]  ; pos.x   â”‚ â† Scalar!          â”‚  â”‚
â”‚  â”‚  â”‚ movss   xmm1, [rcx+0x1C]  ; vel.x   â”‚   Mono KHÃ”NG       â”‚  â”‚
â”‚  â”‚  â”‚ movss   xmm2, [rip+dt]    ; dt       â”‚   vectorize.       â”‚  â”‚
â”‚  â”‚  â”‚ mulss   xmm1, xmm2        ; vel*dt   â”‚   Tá»«ng float       â”‚  â”‚
â”‚  â”‚  â”‚ addss   xmm0, xmm1        ; pos+vel  â”‚   má»™t.             â”‚  â”‚
â”‚  â”‚  â”‚ movss   [rcx+0x10], xmm0  ; store    â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ ; ... láº·p cho y, z                    â”‚ â† 3Ã— lá»‡nh         â”‚  â”‚
â”‚  â”‚  â”‚ pop     rbp                          â”‚   thay vÃ¬ 1Ã—       â”‚  â”‚
â”‚  â”‚  â”‚ ret                                  â”‚   SIMD!             â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Láº§n gá»i sau: Cháº¡y native code ÄÃƒ COMPILE (khÃ´ng JIT láº¡i)   â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€ Garbage Collector (Boehm GC) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  - Non-generational, non-compacting                          â”‚  â”‚
â”‚  â”‚  - Stop-the-world khi GC                                     â”‚  â”‚
â”‚  â”‚  - KHÃ”NG di chuyá»ƒn objects â†’ fragmentation theo thá»i gian     â”‚  â”‚
â”‚  â”‚  - Unity 2021+: Incremental GC (chia nhá» GC work)           â”‚  â”‚
â”‚  â”‚    â†’ Má»—i frame GC chá»‰ lÃ m 1-2ms thay vÃ¬ 10-20ms            â”‚  â”‚
â”‚  â”‚    â†’ Váº«n cÃ³ overhead, nhÆ°ng khÃ´ng spike                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  Æ¯u Ä‘iá»ƒm Mono:                                                     â”‚
â”‚  âœ… Iterate Cá»°C NHANH (Save â†’ Play ~2-10s)                        â”‚
â”‚  âœ… Debugging tá»‘t (breakpoints, watches chÃ­nh xÃ¡c)                  â”‚
â”‚  âœ… Reflection Ä‘áº§y Ä‘á»§ (GetType, Activator.CreateInstance)           â”‚
â”‚                                                                     â”‚
â”‚  NhÆ°á»£c Ä‘iá»ƒm Mono:                                                  â”‚
â”‚  âŒ Runtime performance kÃ©m (no SIMD, weak inlining)                â”‚
â”‚  âŒ JIT stutter frame Ä‘áº§u khi method má»›i Ä‘Æ°á»£c gá»i                  â”‚
â”‚  âŒ KhÃ´ng dÃ¹ng Ä‘Æ°á»£c trÃªn iOS (Apple cáº¥m JIT)                       â”‚
â”‚  âŒ Build size lá»›n (kÃ¨m Mono runtime)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2. IL2CPP â€” Ahead-of-Time Compilation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      IL2CPP PIPELINE                                â”‚
â”‚                                                                     â”‚
â”‚  Build Process (khi báº¡n báº¥m Build):                                 â”‚
â”‚                                                                     â”‚
â”‚  IL (.dll)                                                          â”‚
â”‚     â”‚                                                               â”‚
â”‚     â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€ IL2CPP Transpiler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  IL â†’ C++ Source Code                                         â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  VÃ­ dá»¥ chuyá»ƒn Ä‘á»•i:                                            â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  C# Original:                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  public class Enemy {                                â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      public float health = 100f;                     â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      public void TakeDamage(float dmg) {             â”‚     â”‚  â”‚
â”‚  â”‚  â”‚          health -= dmg;                               â”‚     â”‚  â”‚
â”‚  â”‚  â”‚          if (health <= 0) Die();                      â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      }                                                â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  }                                                    â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                         â†“ IL2CPP                               â”‚  â”‚
â”‚  â”‚  C++ Output:                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  struct Enemy_t : public RuntimeObject {             â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      float health;    // Public field â†’ direct accessâ”‚     â”‚  â”‚
â”‚  â”‚  â”‚  };                                                  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  void Enemy_TakeDamage_m1234(                        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      Enemy_t* __this, float dmg) {                   â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      NullCheck(__this);  // C# null safety            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      __this->health -= dmg;                           â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      if (__this->health <= 0.0f) {                    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚          Enemy_Die_m5678(__this);                      â”‚     â”‚  â”‚
â”‚  â”‚  â”‚      }                                                â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  }                                                    â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Äáº·c biá»‡t:                                                   â”‚  â”‚
â”‚  â”‚  - C# class â†’ C++ struct + RuntimeObject header (GC metadata)â”‚  â”‚
â”‚  â”‚  - C# virtual method â†’ C++ vtable lookup                     â”‚  â”‚
â”‚  â”‚  - C# interface â†’ C++ interface table                        â”‚  â”‚
â”‚  â”‚  - GC váº«n hoáº¡t Ä‘á»™ng! (Boehm GC embedded trong IL2CPP runtime)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                               â”‚
â”‚     â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€ Platform C++ Compiler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Windows:  MSVC /O2 /GL (Link-Time Optimization)              â”‚  â”‚
â”‚  â”‚  Android:  NDK Clang -O3 -flto                                â”‚  â”‚
â”‚  â”‚  iOS:      Xcode Clang -Os (Size Optimization)                â”‚  â”‚
â”‚  â”‚  WebGL:    Emscripten â†’ WASM                                  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  C++ compiler optimizations:                                  â”‚  â”‚
â”‚  â”‚  âœ… Inlining (hÃ m nhá» â†’ paste vÃ o caller)                    â”‚  â”‚
â”‚  â”‚  âœ… Dead Code Elimination (code khÃ´ng dÃ¹ng â†’ xÃ³a)             â”‚  â”‚
â”‚  â”‚  âœ… Loop Unrolling (giáº£m branch overhead)                     â”‚  â”‚
â”‚  â”‚  âœ… Constant Propagation (biáº¿t giÃ¡ trá»‹ â†’ tÃ­nh sáºµn)            â”‚  â”‚
â”‚  â”‚  âœ… Partial SIMD (compiler tá»± vectorize má»™t pháº§n)             â”‚  â”‚
â”‚  â”‚  âœ… LTO (xÃ³a code chÆ°a dÃ¹ng ACROSS all files)                â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                               â”‚
â”‚     â–¼                                                               â”‚
â”‚  Native binary (executable/library)                                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€ Code Stripping â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  IL2CPP + Linker xÃ³a code KHÃ”NG ÄÆ¯á»¢C Gá»ŒI:                    â”‚  â”‚
â”‚  â”‚  - Unused MonoBehaviours                                      â”‚  â”‚
â”‚  â”‚  - Unused .NET library methods                                â”‚  â”‚
â”‚  â”‚  - Dead code paths                                            â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  âš  Cáº¢NH BÃO: Náº¿u dÃ¹ng Reflection â†’ code cÃ³ thá»ƒ bá»‹ strip    â”‚  â”‚
â”‚  â”‚  â†’ Cáº§n link.xml Ä‘á»ƒ preserve                                   â”‚  â”‚
â”‚  â”‚  â†’ DOTS SystemAPI.Query trÃ¡nh Ä‘Æ°á»£c váº¥n Ä‘á» nÃ y               â”‚  â”‚
â”‚  â”‚    (vÃ¬ source generators táº¡o direct calls, khÃ´ng reflection) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  Build time: 5-30 phÃºt (tÃ¹y project size)                           â”‚
â”‚  â†’ ÄÃ¡nh Ä‘á»•i: iteration cháº­m, nhÆ°ng runtime performance cao          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3. So sÃ¡nh Mono vs IL2CPP â€” Quyáº¿t Ä‘á»‹nh thá»±c tiá»…n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONO vs IL2CPP                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   â”‚ Mono (JIT)           â”‚ IL2CPP (AOT)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Compilation       â”‚ Runtime (JIT)        â”‚ Build time (AOT)         â”‚
â”‚ Build Speed       â”‚ â˜…â˜…â˜…â˜…â˜… (2-10s)       â”‚ â˜…â˜…â˜†â˜†â˜† (5-30 min)        â”‚
â”‚ Runtime Speed     â”‚ â˜…â˜…â˜†â˜†â˜†                â”‚ â˜…â˜…â˜…â˜…â˜†                   â”‚
â”‚ SIMD              â”‚ âŒ KhÃ´ng              â”‚ âš  Háº¡n cháº¿ (auto only)   â”‚
â”‚ GC                â”‚ Boehm                â”‚ Boehm (same!)            â”‚
â”‚ Code Stripping    â”‚ âŒ KhÃ´ng              â”‚ âœ… Aggressive             â”‚
â”‚ Build Size        â”‚ Lá»›n (+Mono runtime)  â”‚ Nhá» hÆ¡n (stripped)       â”‚
â”‚ Debugging         â”‚ â˜…â˜…â˜…â˜…â˜… (nguá»“n C#)    â”‚ â˜…â˜…â˜…â˜†â˜† (C++ stack traces)â”‚
â”‚ Reflection        â”‚ âœ… Äáº§y Ä‘á»§             â”‚ âš  Cáº§n link.xml          â”‚
â”‚ Platform          â”‚ Editor, PC, Mac      â”‚ Táº¤T Cáº¢ (báº¯t buá»™c iOS)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DÃ¹ng khi          â”‚ Development/Editor   â”‚ Production Builds        â”‚
â”‚                   â”‚ Prototype nhanh      â”‚ Ship to players          â”‚
â”‚                   â”‚ Quick testing        â”‚ Performance-critical     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. DOTS â€” Unity High-Performance Stack

### 3.1. DOTS = 3 Trá»¥ cá»™t

```
DOTS (Data-Oriented Technology Stack):

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                 â”‚
  â”‚  â”Œâ”€â”€ ECS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚  Entity Component System                               â”‚     â”‚
  â”‚  â”‚  â†’ Data layout tá»‘i Æ°u cho Cache (Chapter 2)            â”‚     â”‚
  â”‚  â”‚  â†’ Archetype Chunks: 16 KB contiguous memory           â”‚     â”‚
  â”‚  â”‚  â†’ SOA (Struct of Arrays) thay vÃ¬ AOS                  â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                        â”‚                                        â”‚
  â”‚                        â–¼                                        â”‚
  â”‚  â”Œâ”€â”€ Job System â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚  Multithreaded Execution                               â”‚     â”‚
  â”‚  â”‚  â†’ Chia cÃ´ng viá»‡c cho ALL CPU cores (Chapter 3)        â”‚     â”‚
  â”‚  â”‚  â†’ Safety system: tá»± kiá»ƒm tra race conditions          â”‚     â”‚
  â”‚  â”‚  â†’ Zero locking: Dá»¯ liá»‡u partition theo chunk          â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                        â”‚                                        â”‚
  â”‚                        â–¼                                        â”‚
  â”‚  â”Œâ”€â”€ Burst Compiler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚  LLVM-based AOT Compiler                               â”‚     â”‚
  â”‚  â”‚  â†’ SIMD auto-vectorization (Chapter 3)                 â”‚     â”‚
  â”‚  â”‚  â†’ Bounds check elimination                            â”‚     â”‚
  â”‚  â”‚  â†’ Aggressive inlining                                 â”‚     â”‚
  â”‚  â”‚  â†’ Platform-specific: SSE/AVX/NEON/WASM-SIMD           â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                                                 â”‚
  â”‚  Káº¿t há»£p: ECS Ã— Jobs Ã— Burst = ÄÃ’N Báº¨Y NHÃ‚N                   â”‚
  â”‚    â†’ Cache efficiency Ã— Thread parallelism Ã— SIMD width         â”‚
  â”‚    â†’ 5Ã— cache Ã— 8Ã— cores Ã— 4-8Ã— SIMD = ~160-320Ã— vs Mono     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2. ECS Memory Layout â€” Táº¡i sao DOTS nhanh?

```
â•â•â• VÃ­ dá»¥: 10,000 Entities cÃ³ Position + Velocity + Health â•â•â•


MonoBehaviour (AOS â€” Array of Structs):

  Má»—i Enemy object trÃªn Managed Heap:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Object Header â”‚ vtable â”‚ pos.x â”‚ pos.y â”‚ pos.z â”‚ vel.x â”‚  â”‚
  â”‚  16 bytes     â”‚  8B    â”‚  4B   â”‚  4B   â”‚  4B   â”‚  4B   â”‚  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚ vel.y â”‚ vel.z â”‚ health â”‚ name_ref â”‚ rb_ref â”‚ anim_ref â”‚  â”‚
  â”‚  4B   â”‚  4B   â”‚  4B    â”‚    8B    â”‚   8B   â”‚    8B    â”‚  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Total: ~80 bytes per enemy (scattered on heap!)

  Äá»ƒ duyá»‡t position:
  â†’ Load 80 bytes nhÆ°ng chá»‰ cáº§n 12 bytes (pos) = 85% lÃ£ng phÃ­!
  â†’ Má»—i enemy á»Ÿ vá»‹ trÃ­ random trÃªn heap â†’ Cache Miss liÃªn tá»¥c


ECS (SOA â€” Struct of Arrays) â€” Archetype Chunk:

  Chunk A (Archetype: Position+Velocity+Health, 16 KB):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Chunk Header: Entity count, Archetype info (256 bytes)       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Entity IDs:                                                  â”‚
  â”‚ [E0][E1][E2][E3]...[E659]                                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Position Data (SOA):                                         â”‚
  â”‚ [pos0.x][pos0.y][pos0.z] [pos1.x][pos1.y][pos1.z] ...      â”‚
  â”‚  12B per entity Ã— 660 entities = 7,920 bytes                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Velocity Data (SOA):                                         â”‚
  â”‚ [vel0.x][vel0.y][vel0.z] [vel1.x][vel1.y][vel1.z] ...      â”‚
  â”‚  12B per entity Ã— 660 entities = 7,920 bytes                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Health Data (SOA):                                           â”‚
  â”‚ [hp0][hp1][hp2][hp3]...[hp659]                               â”‚
  â”‚  4B per entity Ã— 660 entities = 2,640 bytes                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Total: ~18.7 KB per chunk â‰ˆ 660 entities / chunk

  Äá»ƒ duyá»‡t position:
  â†’ Äá»c liÃªn tá»¥c 7,920 bytes!
  â†’ Cache Line (64B) = ~5 entities â†’ Cache Hit 80%+
  â†’ KHÃ”NG cÃ³ dá»¯ liá»‡u thá»«a â†’ 0% lÃ£ng phÃ­ bandwidth


Sá»‘ liá»‡u thá»±c táº¿ (10,000 entities, position += velocity * dt):

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  MonoBehaviour:                                               â”‚
  â”‚    - 10,000 Ã— virtual call Update() overhead = ~1.5ms        â”‚
  â”‚    - 10,000 Ã— Cache Miss (scattered heap) = ~2.0ms           â”‚
  â”‚    - 10,000 Ã— managedâ†’native transition = ~1.0ms             â”‚
  â”‚    - Scalar math (no SIMD) = ~1.0ms                          â”‚
  â”‚    - Single thread only                                      â”‚
  â”‚    Total: ~5.5ms on 1 core                                   â”‚
  â”‚                                                               â”‚
  â”‚  DOTS (ECS + Burst + Jobs):                                   â”‚
  â”‚    - 0 virtual calls (ISystem direct dispatch)               â”‚
  â”‚    - ~16 chunks Ã— sequential iteration â†’ Cache Hit 95%+      â”‚
  â”‚    - No managedâ†’native (pure Burst) = 0ms overhead           â”‚
  â”‚    - AVX2 SIMD: 8 entities per instruction                   â”‚
  â”‚    - 8 cores parallel (ScheduleParallel)                     â”‚
  â”‚    Total: ~0.04ms on 8 cores                                  â”‚
  â”‚                                                               â”‚
  â”‚    Speedup: 5.5ms / 0.04ms = ~137Ã—                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3. Burst Compiler â€” Xem mÃ£ mÃ¡y thá»±c táº¿

```
C# Job code:

  [BurstCompile]
  struct MoveJob : IJobParallelFor
  {
      public NativeArray<float3> positions;
      [ReadOnly] public NativeArray<float3> velocities;
      public float deltaTime;
      
      public void Execute(int i)
      {
          positions[i] += velocities[i] * deltaTime;
      }
  }


Burst Inspector output (x86-64, AVX2):

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ; Burst-generated assembly (simplified)                       â”‚
  â”‚                                                                 â”‚
  â”‚  .loop:                                                         â”‚
  â”‚      vbroadcastss  ymm0, [deltaTime]       ; dt â†’ 8 copies     â”‚
  â”‚                                                                 â”‚
  â”‚      ; Load 8 velocities (x components) â†’ 1 register           â”‚
  â”‚      vmovups       ymm1, [velocities + rax]                     â”‚
  â”‚      ; Load 8 positions  (x components) â†’ 1 register           â”‚
  â”‚      vmovups       ymm2, [positions + rax]                      â”‚
  â”‚                                                                 â”‚
  â”‚      ; position.x += velocity.x * dt (for 8 entities at once!) â”‚
  â”‚      vfmadd231ps   ymm2, ymm1, ymm0                            â”‚
  â”‚      ;   â†‘ Fused Multiply-Add: ymm2 = ymm1 * ymm0 + ymm2      â”‚
  â”‚      ;     1 instruction does both multiply AND add!            â”‚
  â”‚                                                                 â”‚
  â”‚      vmovups       [positions + rax], ymm2  ; Store back        â”‚
  â”‚                                                                 â”‚
  â”‚      ; ... repeat for y, z components                           â”‚
  â”‚                                                                 â”‚
  â”‚      add           rax, 32                  ; Next 8 entities   â”‚
  â”‚      cmp           rax, rcx                 ; Loop bound        â”‚
  â”‚      jl            .loop                                        â”‚
  â”‚                                                                 â”‚
  â”‚  ; Total per iteration of 8 entities:                           â”‚
  â”‚  ;   - 3 loads (pos x,y,z)                                     â”‚
  â”‚  ;   - 3 loads (vel x,y,z)                                     â”‚
  â”‚  ;   - 3 FMA  (multiply + add)                                 â”‚
  â”‚  ;   - 3 stores (pos x,y,z)                                    â”‚
  â”‚  ;   = 12 instructions for 8 entities = 1.5 inst/entity!       â”‚
  â”‚  ;                                                              â”‚
  â”‚  ;   Mono would need ~12-15 instructions PER entity.            â”‚
  â”‚  ;   â†’ Burst: 8Ã— fewer instructions (SIMD width alone)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CÃ¡ch má»Ÿ Burst Inspector trong Unity:
  Jobs â†’ Burst â†’ Open Inspector
  â†’ Chá»n Job hoáº·c System
  â†’ Tab "Assembly" â†’ xem mÃ£ mÃ¡y thá»±c táº¿
  â†’ Tab "Summary" â†’ xem safety checks, SIMD width
  â†’ CÃ”NG Cá»¤ MÃƒ Máº NH NHáº¤T Ä‘á»ƒ hiá»ƒu code Ä‘ang cháº¡y tháº¿ nÃ o!
```

### 3.4. Job System â€” PhÃ¢n chia cÃ´ng viá»‡c cho nhiá»u cores

```
VÃ­ dá»¥: IJobParallelFor chia 10,000 entities cho 8 cores:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                â”‚
  â”‚  Main Thread:                                                  â”‚
  â”‚    var job = new MoveJob { ... };                               â”‚
  â”‚    var handle = job.ScheduleParallel(10000, 64, dependency);   â”‚
  â”‚    //                                           â†‘               â”‚
  â”‚    //                               Batch Size = 64 entities   â”‚
  â”‚    //                           (má»—i "work item" xá»­ lÃ½ 64)    â”‚
  â”‚                                                                â”‚
  â”‚  Job System tá»± chia:                                           â”‚
  â”‚    10,000 Ã· 64 = 157 work items (batches)                     â”‚
  â”‚    ÄÆ°a 157 items vÃ o Work Stealing Queue                      â”‚
  â”‚                                                                â”‚
  â”‚  Worker Threads (7 threads + main thread):                     â”‚
  â”‚                                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚  â”‚Core 0  â”‚ â”‚Core 1  â”‚ â”‚Core 2  â”‚ â”‚Core 3  â”‚                  â”‚
  â”‚  â”‚Batch   â”‚ â”‚Batch   â”‚ â”‚Batch   â”‚ â”‚Batch   â”‚                  â”‚
  â”‚  â”‚0-19    â”‚ â”‚20-39   â”‚ â”‚40-59   â”‚ â”‚60-79   â”‚                  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚  â”‚Core 4  â”‚ â”‚Core 5  â”‚ â”‚Core 6  â”‚ â”‚Core 7  â”‚                  â”‚
  â”‚  â”‚Batch   â”‚ â”‚Batch   â”‚ â”‚Batch   â”‚ â”‚Batch   â”‚                  â”‚
  â”‚  â”‚80-99   â”‚ â”‚100-119 â”‚ â”‚120-139 â”‚ â”‚140-156 â”‚                  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚                                                                â”‚
  â”‚  Work Stealing:                                                â”‚
  â”‚    Core 3 xong sá»›m â†’ "Äƒn trá»™m" batch tá»« Core 7 (cháº­m nháº¥t)  â”‚
  â”‚    â†’ Táº¥t cáº£ cores LUÃ”N Báº¬N â†’ hiá»‡u quáº£ tá»‘i Ä‘a!                â”‚
  â”‚                                                                â”‚
  â”‚  Safety System:                                                â”‚
  â”‚    - NativeArray cÃ³ safety handle â†’ detect race conditions     â”‚
  â”‚    - [ReadOnly] tag â†’ nhiá»u Jobs Ä‘á»c song song                â”‚
  â”‚    - KhÃ´ng [ReadOnly] â†’ exclusive access, enforce sequential   â”‚
  â”‚    - Safety checks = Editor only â†’ zero cost in build         â”‚
  â”‚                                                                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Tá»•ng káº¿t â€” HÃ nh trÃ¬nh tá»« Transistor Ä‘áº¿n 1 Frame trong Unity

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  HÃ€NH TRÃŒNH Cá»¦A 1 FRAME GAME â€” Tá»ª ELECTRON Äáº¾N PIXEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Báº¡n nháº¥n nÃºt di chuyá»ƒn nhÃ¢n váº­t. Trong 16.67ms (60 FPS), Ä‘iá»u gÃ¬ xáº£y ra?


  â”Œâ”€â”€ Táº¦NG 1: Váº¬T LÃ (Chapter 1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  âš¡ Transistors (hÃ ng Tá»¶ trÃªn chip CPU + GPU)                    â”‚
  â”‚     â†’ ÄÃ³ng/Má»Ÿ theo tÃ­n hiá»‡u Ä‘iá»‡n Ã¡p (0V = 0, 3.3V = 1)        â”‚
  â”‚     â†’ Táº¡o thÃ nh Logic Gates (AND, OR, NOT, XOR)                 â”‚
  â”‚     â†’ Gates káº¿t há»£p â†’ ALU (phÃ©p cá»™ng, trá»«, so sÃ¡nh)            â”‚
  â”‚     â†’ ALU + Registers + Control Unit = CPU Core                 â”‚
  â”‚                                                                  â”‚
  â”‚  Táº¥t cáº£ diá»…n ra á»Ÿ tá»‘c Ä‘á»™ 5 GHz = 5 tá»· láº§n Ä‘Ã³ng/má»Ÿ má»—i giÃ¢y   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
  â”Œâ”€â”€ Táº¦NG 2: Bá»˜ NHá»š (Chapter 2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  ğŸ“¦ Dá»¯ liá»‡u game (positions, velocities, health) náº±m trong:     â”‚
  â”‚     NativeArray<float3> â†’ Unmanaged Heap â†’ DDR5 RAM             â”‚
  â”‚                                                                  â”‚
  â”‚  Khi CPU Ä‘á»c position[0]:                                       â”‚
  â”‚     RAM (100ns) â†’ L3 (10ns) â†’ L2 (3ns) â†’ L1 (1ns) â†’ Register  â”‚
  â”‚     + Táº£i nguyÃªn Cache Line 64 bytes                            â”‚
  â”‚     â†’ positions[1..4] miá»…n phÃ­ (ECS contiguous layout!)         â”‚
  â”‚                                                                  â”‚
  â”‚  Archetype Chunk 16KB â†’ vá»«a váº·n trong L1 Cache (32-64 KB)      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
  â”Œâ”€â”€ Táº¦NG 3: CPU EXECUTION (Chapter 3) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  ğŸ”§ Burst Compiler Ä‘Ã£ compile C# MoveJob â†’ x86-64 native code   â”‚
  â”‚     â†’ Sá»­ dá»¥ng AVX2 registers (YMM0-YMM15): 256-bit wide        â”‚
  â”‚     â†’ VFMADD231PS: pos += vel Ã— dt cho 8 entities/instruction   â”‚
  â”‚     â†’ Pipeline 20+ stages, Out-of-Order execution               â”‚
  â”‚     â†’ No branches trong tight loop â†’ Pipeline khÃ´ng bá»‹ flush    â”‚
  â”‚                                                                  â”‚
  â”‚  Job System phÃ¢n chia:                                           â”‚
  â”‚     10,000 entities Ã· 8 cores Ã— 8 SIMD =                        â”‚
  â”‚     ~156 iterations per core â†’ hoÃ n thÃ nh trong ~0.04ms          â”‚
  â”‚                                                                  â”‚
  â”‚  Song song: CPU cÅ©ng cháº¡y AI, Physics, Audio trÃªn cÃ¡c cores     â”‚
  â”‚  khÃ¡c hoáº·c trong cÃ¡c Jobs khÃ¡c                                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
  â”Œâ”€â”€ Táº¦NG 4: GPU RENDERING (Chapter 4) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  ğŸ¨ CPU submit Command Buffer â†’ GPU qua PCIe/shared memory      â”‚
  â”‚                                                                  â”‚
  â”‚  GPU Pipeline:                                                   â”‚
  â”‚  â‘  Vertex Shader:                                                â”‚
  â”‚     â†’ 500K vertices Ã— MVP matrix transform                      â”‚
  â”‚     â†’ 46 SM Ã— 128 cores = 5,888 vertices Ä‘á»“ng thá»i             â”‚
  â”‚                                                                  â”‚
  â”‚  â‘¡ Rasterizer:                                                   â”‚
  â”‚     â†’ Tam giÃ¡c â†’ Fragments (Fixed-function hardware)             â”‚
  â”‚     â†’ Barycentric interpolation cho UV, Normal                   â”‚
  â”‚                                                                  â”‚
  â”‚  â‘¢ Fragment Shader:                                              â”‚
  â”‚     â†’ PBR Lighting: Cook-Torrance BRDF                           â”‚
  â”‚     â†’ 4M fragments Ã— (albedo + normal + roughness + shadow)      â”‚
  â”‚     â†’ SIMT: 1 Warp = 32 pixels cÃ¹ng lÃºc                         â”‚
  â”‚     â†’ Branchless: step(), lerp() thay if/else                   â”‚
  â”‚     â†’ Half precision (16-bit) cho mobile bandwidth               â”‚
  â”‚                                                                  â”‚
  â”‚  â‘£ Post-Processing:                                              â”‚
  â”‚     â†’ Bloom + Tonemapping + FXAA                                 â”‚
  â”‚     â†’ Fullscreen passes trÃªn Compute Shaders                     â”‚
  â”‚                                                                  â”‚
  â”‚  Tá»•ng GPU time: ~6-8ms                                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
  â”Œâ”€â”€ Táº¦NG 5: UNITY ENGINE (Chapter 5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  ğŸ® Unity Runtime orchestrates:                                  â”‚
  â”‚                                                                  â”‚
  â”‚  C++ Backend:                                                    â”‚
  â”‚     â†’ SRP Core submit draw calls                                â”‚
  â”‚     â†’ PhysX collisions resolved                                 â”‚
  â”‚     â†’ Memory allocators manage pools                             â”‚
  â”‚                                                                  â”‚
  â”‚  C# Frontend (IL2CPP / Burst):                                  â”‚
  â”‚     â†’ Game logic â†’ IL â†’ C++ â†’ Native (IL2CPP)                   â”‚
  â”‚     â†’ DOTS Jobs â†’ IL â†’ LLVM â†’ SIMD Native (Burst)               â”‚
  â”‚     â†’ Zero GC: NativeArrays + struct components                  â”‚
  â”‚                                                                  â”‚
  â”‚  Frame complete: Framebuffer â†’ V-Sync â†’ Display                  â”‚
  â”‚  Total: CPU ~4ms + GPU ~8ms = 12ms â†’ 83 FPS âœ…                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â• CHUá»–I LOGIC DUY NHáº¤T â•â•â•

  Electron â†’ Transistor â†’ Logic Gate â†’ ALU â†’ CPU Core
       â†’ Cache â†’ RAM â†’ Assembly â†’ C++ â†’ C# â†’ IL â†’ Burst/IL2CPP
            â†’ Native SIMD code â†’ Multi-core Jobs â†’ ECS Chunks
                 â†’ Command Buffer â†’ GPU Pipeline â†’ Pixels
                      â†’ Display â†’ Máº®T NGÆ¯á»œI (60 láº§n/giÃ¢y)

  ToÃ n bá»™ chuá»—i nÃ y â€” tá»« electron Ä‘Ã³ng/má»Ÿ transistor
  Ä‘áº¿n pixel sÃ¡ng trÃªn mÃ n hÃ¬nh â€” diá»…n ra trong

                    â˜… 16.67 MILLISECONDS â˜…

  Tá»©c lÃ  16.67 PHáº¦N NGHÃŒN cá»§a 1 giÃ¢y.
  Nhanh hÆ¡n 1 cÃ¡i chá»›p máº¯t (300-400ms) khoáº£ng 20 láº§n.
```

---

## 5. Báº£ng tá»•ng há»£p â€” Quick Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       UNITY DEVELOPER â€” HARDWARE KNOWLEDGE QUICK REFERENCE          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ KhÃ¡i niá»‡m         â”‚ áº¢nh hÆ°á»Ÿng thá»±c táº¿ trong Unity                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cache Line 64B    â”‚ ECS Chunks: data liÃªn tá»¥c â†’ Cache Hit 95%+      â”‚
â”‚ Branch Prediction â”‚ math.select() thay if/else trong Burst Jobs     â”‚
â”‚ SIMD (AVX2)       â”‚ Burst auto-vectorize: 8 entities/instruction    â”‚
â”‚ Pipeline Stall    â”‚ Avoid data dependency chains trong tight loops   â”‚
â”‚ False Sharing     â”‚ Má»—i Job nÃªn cÃ³ read/write set riÃªng biá»‡t       â”‚
â”‚ GC Stop-the-World â”‚ Zero alloc: NativeArray, struct, object pool    â”‚
â”‚ Branch Divergence â”‚ Branchless shader: step(), lerp(), smoothstep() â”‚
â”‚ Bandwidth (GPU)   â”‚ Tex compression (ASTC), half precision, LODs    â”‚
â”‚ Draw Calls        â”‚ SRP Batcher + GPU Instancing + Indirect         â”‚
â”‚ TBR (Mobile)      â”‚ Minimize render passes, MSAA free trÃªn mobile   â”‚
â”‚ Managedâ†”Native    â”‚ Cache GetComponent á»Ÿ Awake, prefer DOTS queries â”‚
â”‚ IL2CPP vs Mono    â”‚ Dev=Mono, Build=IL2CPP, HotPath=Burst           â”‚
â”‚ Occupancy (GPU)   â”‚ Giáº£m register pressure, shader Ä‘Æ¡n giáº£n hÆ¡n    â”‚
â”‚ Memory Hierarchy  â”‚ Allocator.Temp < TempJob < Persistent            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

> **Káº¿t:** Hiá»ƒu pháº§n cá»©ng khÃ´ng pháº£i Ä‘á»ƒ trá»Ÿ thÃ nh ká»¹ sÆ° chip. MÃ  Ä‘á»ƒ khi báº¡n viáº¿t `position += velocity * deltaTime`, báº¡n biáº¿t chÃ­nh xÃ¡c:
> - **Dá»¯ liá»‡u náº±m á»Ÿ Ä‘Ã¢u** (Register? L1 Cache? RAM? VRAM?)
> - **CÃ¢u lá»‡nh cháº¡y tháº¿ nÃ o** (Scalar hay SIMD? Pipelined hay stalled?)
> - **Táº¡i sao cÃ¡ch nÃ y nhanh hÆ¡n cÃ¡ch kia** (Cache locality? No branching? Parallelism?)
>
> ÄÃ³ lÃ  sá»± khÃ¡c biá»‡t giá»¯a **viáº¿t code cháº¡y Ä‘Æ°á»£c** vÃ  **viáº¿t code cháº¡y NHANH**.

---
*Chapter 5 (Final) â€” NghiÃªn cá»©u cho Unity High-Performance Agent*
